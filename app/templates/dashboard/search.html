{% extends 'base.html' %}
{% block title %}Search Results{% endblock %}

{% block content %}
<div class="page-header animate-in">
    <h1 class="text-gradient">Search Results</h1>
    <!-- [VULN: CH08-C01] Reflected XSS â€” query rendered unescaped -->
    <p>Results for: {{ query | safe }}</p>
</div>

<form action="/search" method="GET" class="mb-2 animate-in" style="animation-delay:0.03s;">
    <div class="flag-input-group">
        <input type="search" name="q" value="{{ query }}" placeholder="Search..." class="form-control">
        <button type="submit" class="btn btn-primary" style="display:flex;align-items:center;gap:6px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            Search
        </button>
    </div>
</form>

{% if results %}
<div class="card animate-in" style="animation-delay:0.06s;">
    <div class="card-header">
        <h3 style="display:flex;align-items:center;gap:8px;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            Found {{ results | length }} result(s)
        </h3>
    </div>
    <div class="card-body">
        <table>
            <thead>
                <tr><th>ID</th><th>Username</th><th>Email</th><th>Role</th></tr>
            </thead>
            <tbody>
                {% for user in results %}
                <tr class="animate-in" style="animation-delay:{{ loop.index * 0.02 }}s;">
                    <td style="color:var(--text-muted);">#{{ user.id }}</td>
                    <td><a href="/profile/{{ user.id }}" style="color:var(--accent);">{{ user.username }}</a></td>
                    <td>{{ user.email }}</td>
                    <td><span class="badge badge-info">{{ user.role }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="card animate-in" style="animation-delay:0.06s;">
    <div class="card-body" style="text-align:center; padding:48px 24px;">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.5" style="opacity:0.4;margin-bottom:12px;"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <p style="color:var(--text-muted);">No results found for "{{ query | safe }}"</p>
    </div>
</div>
{% endif %}
{% endblock %}
