{% extends 'base.html' %}
{% block title %}Session Restore{% endblock %}

{% block content %}
<div class="page-header animate-in">
    <div style="display:flex;align-items:center;gap:10px;">
        <a href="/tools" class="btn btn-sm" style="display:flex;align-items:center;gap:4px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
            Back
        </a>
    </div>
    <h1 class="text-gradient">Session Restore</h1>
    <p>[VULN: CH11-C06] Unsafe pickle deserialization â€” submit base64-encoded pickle data</p>
</div>

<div class="card animate-in" style="animation-delay:0.05s;">
    <div class="card-header">
        <h3 style="display:flex;align-items:center;gap:8px;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
            Restore Session Data
        </h3>
    </div>
    <div class="card-body">
        <form id="restore-form">
            <div class="form-group">
                <label for="data">Base64-encoded session data</label>
                <textarea id="data" name="data" rows="6" placeholder="Paste base64-encoded pickle data here...&#10;&#10;Example: gASVCgAAAAAAAACMBnNlY3JldJQu"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Restore Session</button>
        </form>
        <div id="result" class="mt-2" style="display:none;">
            <div class="card-header"><h4>Result</h4></div>
            <pre id="result-output" style="padding:16px;background:var(--surface);border-radius:var(--radius);color:var(--text-secondary);overflow-x:auto;"></pre>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('restore-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var data = document.getElementById('data').value;
    fetch('/api/restore', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        credentials: 'include',
        body: 'data=' + encodeURIComponent(data)
    })
    .then(r => r.json())
    .then(d => {
        document.getElementById('result').style.display = 'block';
        document.getElementById('result-output').textContent = JSON.stringify(d, null, 2);
    })
    .catch(err => {
        document.getElementById('result').style.display = 'block';
        document.getElementById('result-output').textContent = 'Error: ' + err.message;
    });
});
</script>
{% endblock %}
